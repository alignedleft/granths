<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Grant HS Schedule</title>
    <script type="text/javascript" src="d3.js"></script>
    <link rel="stylesheet" href="base-min.css">
    <link rel="stylesheet" href="grids-responsive-min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <div id="header">
<!--        <h1>Grant High School 2016-2017 Academic Calendar</h1>-->
    <!--
        <p>
            <span class="toggle active" id="ab">A/B Schedule</span>
            <span class="toggle" id="your">Your Classes</span>
        </p>
    -->
    </div>

<script type="text/javascript">





var parseTime = d3.timeParse("%Y-%m-%d");
var getDayOfWeek = d3.timeFormat("%A");
var getDay = d3.timeFormat("%e");
var getMonth = d3.timeFormat("%B");
var getYear = d3.timeFormat("%Y");



//var schedules = {
//    A
//    B
//    Flex B
//    Flex A
//    Early Dismissal A
//    Early Dismissal B
//    Race Forward A
//    Race Forward B
//    Finals
//    First Day
//};




d3.csv("grant_hs_schedule_data.csv", function(data) {
    //console.log(data);



    //Check current date
    var now = new Date();
    //console.log("Now it is " + getMonthDay(now) + " " + getYear(now));



    //
    //  Prep data
    //
    var nested = [];
    var row = 0;
    var col = 0;

    for (var i = 0; i < data.length; i++) {

        data[i].date = parseTime(data[i].date);

        if (typeof nested[row] === "undefined") {
            nested[row] = [];
        }

        //Ignore weekend days
        if (getDayOfWeek(data[i].date) !== "Sunday" && getDayOfWeek(data[i].date) !== "Saturday") {
        
            nested[row][col] = data[i];

            col++;
            if (col === 5) {
                col = 0;
                row++;
            }
        
        }

    }
    //console.table(nested);



    //
    //  Create each row / week
    //
    var weeks = d3.select("body")
        .selectAll("div")
        .data(nested)
        .enter()
        .append("div")
        .attr("class", "pure-g");

    //
    //  Create each div / day
    //
    var days = weeks.selectAll("div")
        .data(function(d) { return d; })
        .enter()
        .append("div")
        .attr("class", "pure-u-1 pure-u-lg-1-5")
        .classed("day", true)
        .classed("today", function(d) {
            //If this is today
            //xxx needs work!
            if (d.date.getTime() == now.getTime()) {
                alert("found today!");
                return true;
            }
        })
        .classed("past", function(d) {
            //If this is in the past
            if (d.date.getTime() < now.getTime()) {
                return true;
            }
        });



    //
    //  Dates
    //
    var dates = days.append("div")
        .attr("class", "date");

    dates.append("div")
        .attr("class", "flag")
        .classed("today", function(d) {
            if (d.date.getTime() <= now.getTime()) {
                return true;
            }
        })
        .text(function(d) {
            if (d.date.getTime() <= now.getTime()) {
                return "today";
            }
        });

    dates.append("div")
        .attr("class", "day")
        .text(function(d) {
            return getDay(d.date);
        });

    var dowMonthYears = dates.append("div")
        .attr("class", "dowMonthYear");
        
    dowMonthYears.append("span")
        .attr("class", "dayofweek")
        .text(function(d) {
            return getDayOfWeek(d.date);
        });
        
    dowMonthYears.append("br");

    dowMonthYears.append("span")
        .attr("class", "monthyear")
        .text(function(d) {
            return getMonth(d.date) + " " + getYear(d.date);
        });








    //
    //  Create one SVG per day
    //
    var w = "100%";
    var h = 500;
    
    var svgs = days.append("svg")
        .attr("width", w)
        .attr("height", h);

    svgs.append("rect")
        .attr("x", 0)
        .attr("y", 0)
        .attr("width", w)
        .attr("height", h)
        .attr("fill", function(d) {

            if (d.schedule === "A" || d.schedule === "Flex A" || d.schedule === "Early Dismissal A" || d.schedule === "Race Forward A") {
                return "#BBDFF7";
                return "#0377C0";
            } else if (d.schedule === "B" || d.schedule === "Flex B" || d.schedule === "Early Dismissal B" || d.schedule === "Race Forward B") {
                return "#BBF7C4";
                return "#5BC6AD";
            } else if (d.schedule === "Finals") {
                return "#ccc";
            } else {
                return "#eee";
            }

        });
    
    //Define a time scale for one day, from 8am to 4pm
    var yScale = d3.scaleTime()
                    .domain([ new Date(2000, 0, 1, 8), new Date(2000, 0, 1, 16) ])
                    .range([ 0, h ]);

    svgs.append("rect")
        .attr("x", "10%")
        .attr("y", yScale(new Date(2000, 0, 1, 8, 15)))
        .attr("width", "90%")
        .attr("height", yScale(new Date(2000, 0, 1, 15, 15)))
        .attr("fill", "purple");









//    cells.append("div")
//        .classed("schedule", true)
//        .style("display", function(d) {
//            if (d.schedule === "") {
//                return "none";
//            }
//        })
//        .text(function(d) {
//            return d.schedule;
//        });
//
//    cells.append("div")
//        .classed("noSchoolReason", true)
//        .style("display", function(d) {
//            if (d.note === "") {
//                return "none";
//            }
//        })
//        .text(function(d) {
//            return d.note;
//        });





    // Toggles

//    d3.select(".toggle#ab")
//        .on("click", function() {
//            d3.selectAll(".toggle").classed("active", false);
//            d3.select(this).classed("active", true);
//            d3.select("table").classed("your", false).classed("ab", true);
//        });
//
//    d3.select(".toggle#your")
//        .on("click", function() {
//            d3.selectAll(".toggle").classed("active", false);
//            d3.select(this).classed("active", true);
//            d3.select("table").classed("your", true).classed("ab", false);
//        });






});





</script>
</body>
</html>
